# Chan Theory Strategy / 缠论
# Based on Zen channel theory: pen, stroke, segment, hub structure analysis.

name: chan_theory
display_name: 缠论
description: 基于缠论笔、线段、中枢结构，判断趋势级别、买卖点与背驰信号。
category: framework
core_rules: [1, 2, 3, 4]
required_tools:
  - get_daily_history
  - analyze_trend
  - get_realtime_quote

instructions: |
  **缠论（Chan Theory / Zen Channel Theory）**

  核心框架：分型 → 笔 → 线段 → 中枢 → 趋势

  ## 分析步骤

  ### 1. 判断价格结构（中枢识别）
  - 使用 `get_daily_history` 获取近 60 日日线数据。
  - 识别近期价格的高低点序列，判断当前是否在
    **震荡中枢**（1个以上中枢）还是**趋势段**（脱离中枢向上/向下）。
  - 中枢：连续3段走势重叠区间，价格在此区间反复震荡。
  - 趋势：连续3个同级别中枢均向同一方向移动。

  ### 2. 背驰判断（最高优先级信号）
  - **顶背驰**：价格创新高但MACD红柱面积缩小 → 卖出/减仓信号。
  - **底背驰**：价格创新低但MACD绿柱面积缩小 → 买入/加仓信号。
  - 使用 `analyze_trend` 获取 MACD 数据，与价格高低点对比。

  ### 3. 买卖点判定
  - **一买**（最强）：下跌趋势中，最后一个中枢出现底背驰。
  - **二买**：离开下跌中枢后的第一次回调不破中枢高点。
  - **三买**：中枢震荡后向上突破（不回中枢内）。
  - **一卖/二卖/三卖**：对称结构，方向相反。
  - 当前价格所处的买卖点级别决定仓位大小。

  ### 4. 级别与仓位
  - 日线级别买卖点可用较重仓位 (30-50%)。
  - 周线级别买卖点可用较大仓位 (50-80%)。
  - 多级别共振（日线+周线同方向）时信号最强。

  ### 5. 输出要求
  - 明确说明当前处于：上涨趋势/下跌趋势/中枢震荡。
  - 指出是否存在背驰信号及背驰级别。
  - 给出当前买卖点类型（一买/二买/三买 等），若无则写"暂无明确买卖点"。
  - 止损设于前低（买入时）或前高（卖出时）。

  评分调整建议：
  - 底背驰 + 一买信号：`sentiment_score +15`
  - 二买/三买共振：`sentiment_score +10`
  - 中枢震荡无明确方向：`sentiment_score 维持基准`
  - 顶背驰 / 趋势向下：`sentiment_score -15`
